function m = Sniffing
    m = module(@find_fast_sniffs,@fake_sniff_trace);
    
    NSniffs = 9;
    NSecs = 2;
    
    average_sniff = [0,-0.0008,0.0157,0.0537,0.1179,0.2152,0.3461,0.4962,0.9496,1.7646,2.1488,2.2794,2.1904,1.9576,1.6605,1.3555,1.0694,0.8166,0.6061,0.4405,0.3145,0.2175,0.1419,0.082,0.0348,0];
    %{
    this average sniff was generated from all first sniffs after odor onset, and then modified to get rid of the
    preinspiration exhalation like so:
    
    NOTE: sampled at 100 Hz, "start" of sniff is at sample 6
    
    >> x = average_first_sniff;
    >> average_sniff = [-x(6:13)+x(6) (x(23)-x(14))/2 x(24:40)-x(40)];
    
    %}
    
    
    function isfast = find_fast_sniffs(stim_times)
        isfast = false(size(stim_times));
        tsniffs = stim_times(NSniffs:length(stim_times)) - stim_times(1:length(stim_times)-NSniffs+1);
        for n = 1:length(stim_times)-NSniffs+1
            if tsniffs(n) < NSecs
                isfast(n:n+NSniffs-1) = true;
            end
        end
    end
    
    function trace = fake_sniff_trace(stim_times, length_in_samps, samplingrate)
        % generates a fake sniff trace
        % using the given stim_times and the average sniff (see above)
        trace = zeros(1,length_in_samps);
        trace(floor(stim_times)+1) = 1;
        
        ctrace = conv(trace,resample(average_sniff,samplingrate,100));
        trace = ctrace((1:length_in_samps)+floor(5*samplingrate/100));
    end
    
    
end